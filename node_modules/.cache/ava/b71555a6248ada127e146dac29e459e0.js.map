{"version":3,"sources":["index.js"],"names":["express","require","pg","fs","bodyParser","multer","upload","app","use","json","urlencoded","extended","contactModel","offerModel","fileUtility","router","Router","set","process","env","PORT","static","__dirname","listen","get","console","log","req","res","next","request","response","render","date","query","enddate","Date","getRecordsBeforeDateAndPostToFTPServer","fileName","readFileFromFTPServer","connect","DATABASE_URL","err","client","done","result","error","send","results","rows","size","length","getOffers","post","postOffer","getContacts","postContact"],"mappings":"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","file":"index.js","sourcesContent":["var express = require('express');\r\nvar pg = require('pg');\r\nvar fs = require('fs');\r\n\r\nvar bodyParser = require('body-parser');\r\nvar multer = require('multer');\r\nvar upload = multer();\r\n\r\nvar app = express();\r\n\r\napp.use(bodyParser.json()); // for parsing application/json\r\napp.use(bodyParser.urlencoded({ extended: false })); // for parsing application/x-www-form-urlencoded\r\n\r\nvar contactModel = require('./models/contact.js');\r\nvar offerModel = require('./models/offer.js');\r\nvar fileUtility = require('./controllers/fileUtility.js');\r\n\r\nvar router = express.Router();\r\n\r\napp.set('port', (process.env.PORT || 5000));\r\napp.use(express.static(__dirname + '/public'));\r\n\r\n// views is directory for all template files\r\napp.set('views', __dirname + '/views');\r\napp.set('view engine', 'ejs');\r\n\r\napp.listen(app.get('port'), function() {\r\n    console.log('Node app is running on port', app.get('port'));\r\n});\r\n\r\nrouter.use(function(req,res,next){\r\n    next();\r\n});\r\n\r\napp.get('/', function(request, response) {\r\n    response.render('pages/index');\r\n});\r\n\r\napp.get('/generateFile',function(request,response){\r\n    var date = request.query.enddate ? new Date(request.query.enddate) : new Date();\r\n    contactModel.getRecordsBeforeDateAndPostToFTPServer(date,'contacts.txt');\r\n    response.render('pages/index');\r\n});\r\n\r\napp.get('/readFile',function(request,response){\r\n    var fileName = '1mb.pak';//request.query.filePath;\r\n    fileUtility.readFileFromFTPServer(fileName);\r\n    response.render('pages/index');\r\n});\r\n\r\napp.get('/offers', function (request, response) {\r\n    pg.connect(process.env.DATABASE_URL, function(err, client, done) {\r\n        client.query('SELECT name FROM offers ', function(err, result) {\r\n            done();\r\n            if (err) {\r\n                console.error(err); response.send(\"Error \" + err);\r\n            } else {\r\n                response.render('pages/offers', {results: result.rows, size: result.rows.length} );\r\n            }\r\n        });\r\n    });\r\n});\r\n\r\n\r\napp.get('/contacts', function (request, response) {\r\n    pg.connect(process.env.DATABASE_URL, function(err, client, done) {\r\n        client.query('SELECT firstname, lastname FROM salesforce.contact ', function(err, result) {\r\n        done();\r\n        if (err) {\r\n            console.error(err); response.send(\"Error \" + err);\r\n        } else {\r\n            response.render('pages/contacts', {results: result.rows, size: result.rows.length} );\r\n        }\r\n        });\r\n    });\r\n});\r\n\r\n\r\nrouter.get('/offers',offerModel.getOffers);\r\nrouter.post('/offers',offerModel.postOffer);\r\nrouter.get('/contacts',contactModel.getContacts);\r\nrouter.post('/contacts',contactModel.postContact);\r\n\r\napp.use('/rest',router);"]}